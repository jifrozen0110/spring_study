# 05. ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”

---

ì§€ê¸ˆê¹Œì§€ ìš°ë¦¬ëŠ”Â `@Bean`ì–´ë…¸í…Œì´ì…˜ì„ í™œìš©í•˜ê±°ë‚˜XML ì„¤ì • íŒŒì¼ì„ ì´ìš©í•˜ì—¬ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ì§ì ‘ ë¹ˆì„ ë“±ë¡í–ˆë‹¤.í•˜ì§€ë§Œ, ë“±ë¡í•˜ëŠ” ë¹ˆì˜ ê°¯ìˆ˜ê°€ ë§ì•„ì§ˆìˆ˜ë¡ ì´ ë˜í•œ ë²ˆê±°ë¡­ê³  ê·€ì°®ì€ ì‘ì—…ì´ ëœë‹¤.

ë¬´ì—‡ë³´ë‹¤ í•´ë‹¹ íŒŒì¼ì„ ì¼ì¼íˆ ê´€ë¦¬í•´ì£¼ì–´ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ìˆë‹¤.

ì´ë¥¼ í•´ì†Œí•´ì£¼ê¸° ìœ„í•´, ìŠ¤í”„ë§ì—ì„œëŠ”Â `@ComponentScan`ì´ë¼ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.ë˜ ì˜ì¡´ê´€ê³„ë„ ìë™ìœ¼ë¡œ ì£¼ì…í•´ì£¼ëŠ”Â `@Autowired`ë¼ëŠ” ê¸°ëŠ¥ë„ ì œê³µí•´ì¤€ë‹¤.

**AutoAppConfig**

```java
@Configuration
@ComponentScan(
        excludeFilters = @ComponentScan.Filter(type = FilterType.ANNOTATION, classes = Configuration.class)
)
public class AutoAppConfig {
}
```

ì´ì „,Â `AppConfig`ì™€ ë¹„ìŠ·í•œ ì—­í• ì„ í•˜ëŠ”Â `AutoAppConfig`í´ë˜ìŠ¤ë¥¼ ìƒì„±í–ˆë‹¤.íŠ¹ì´í•œì ì€,Â `@ComponentScan`ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì—ˆê³ Â `@Bean`ì„ ë“±ë¡í•œ ë©”ì†Œë“œê°€ ì—†ë‹¤.**ê·¸ë ‡ë‹¤ë©´ ì–´ë–»ê²Œ ë™ì‘ì„ í•˜ëŠ” ê²ƒì¸ê°€?Â ğŸ¤”**

ìš°ë¦¬ëŠ” ì–´ë…¸í…Œì´ì…˜ì˜ ì´ë¦„ ê·¸ëŒ€ë¡œì—ì„œ ê·¸ í•´ë‹µì„ ì°¾ì„ ìˆ˜ ìˆë‹¤.`@ComponentScan`Â ì–´ë…¸í…Œì´ì…˜ì€Â `@Component`ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì€ í´ë˜ìŠ¤ë¥¼ ì°¾ëŠ”ë‹¤.ê·¸ë¦¬ê³  ì°¾ì€ í´ë˜ìŠ¤ë“¤ì„ ë¹ˆìœ¼ë¡œ ìë™ ë“±ë¡í•´ì£¼ëŠ” ì—­í• ì„ í•˜ê³  ìˆë‹¤.ê·¸ë ‡ê¸°ì— ë”°ë¡œÂ `@Bean`ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì–´ì„œ ë¹ˆì„ ë“±ë¡í•  í•„ìš”ê°€ ì—†ê¸°ì— ì´ë¥¼ ì œê±°í•œ ê²ƒì´ë‹¤.

í•œ ê°€ì§€ íŠ¹ì´ì ìœ¼ë¡œëŠ”Â `@ComponentScan`ì— ì†ì„±ê°’ì— í•„í„° ê¸°ëŠ¥ì„ ì¶”ê°€í–ˆë‹¤.`excludeFilters`ì€ ì œì™¸í•  í´ë˜ìŠ¤ë¥¼ ì§€ì •í•˜ëŠ”ë° ì‚¬ìš©í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜ ì†ì„±ì´ë‹¤.ì´ì „, ìš°ë¦¬ê°€ ì‚¬ìš©í–ˆë˜Â `AppConfig`ì—ì„œë„ ìš°ë¦¬ê°€ ë“±ë¡í•œ ë¹ˆë“¤ì´ ìˆê¸°ì—`@ComponentScan`ìœ¼ë¡œ ë“±ë¡í•  ë¹ˆ ë“¤ê³¼ ì¶©ëŒì´ ì¼ì–´ë‚˜ê¸°ì—Â `@Configuration`ì´ ë¶™ì€ í´ë˜ìŠ¤ëŠ” ì œì™¸í•œ ê²ƒì´ë‹¤.

ì°¸ê³ ë¡œ, ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì„ ì‚¬ìš©í•˜ë©´Â `@Configuration`Â ì´ ë¶™ì€ ì„¤ì • ì •ë³´ë„ ìë™ìœ¼ë¡œ ë“±ë¡ëœë‹¤.`@Configuration`Â ì´ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì˜ ëŒ€ìƒì´ ëœ ì´ìœ ë„`@Configuration`ì˜ ì†ŒìŠ¤ì½”ë“œë¥¼ ì—´ì–´ë³´ë©´Â `@Component`Â ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì–´ìˆê¸° ë•Œë¬¸ì´ë‹¤.

```java
@Component
public class MemoryMemberRepository implements MemberRepository{
```

ì´ëŸ°ì‹ìœ¼ë¡œ ê¸°ì¡´ì— Bean ì–´ë…¸í…Œì´ì…˜ì„ ë¶‡ì—¬ ë¹ˆì„ ë“±ë¡í–ˆë˜ í´ë˜ìŠ¤ì— ëª¨ë‘ `@Component` ë¥¼ ë¶™ì—¬ì¤€ë‹¤.

ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ê³¼ ìë™ ì˜ì¡´ê´€ê³„ ì£¼ì…ì´ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ê·¸ë¦¼ìœ¼ë¡œ ì•Œì•„ë³´ì.

**1. @ComponentScan**

![ì œëª©](../ì´ë¯¸ì§€/05_ì»´í¬ë„ŒíŠ¸_ìŠ¤ìº”.png)

`@ComponentScan` ì€ `@Component` ê°€ ë¶™ì€ ëª¨ë“  í´ë˜ìŠ¤ë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•œë‹¤.
ì´ë•Œ ìŠ¤í”„ë§ ë¹ˆì˜ ê¸°ë³¸ ì´ë¦„ì€ í´ë˜ìŠ¤ëª…ì„ ì‚¬ìš©í•˜ë˜ ë§¨ ì•ê¸€ìë§Œ ì†Œë¬¸ìë¥¼ ì‚¬ìš©í•œë‹¤.
**ë¹ˆ ì´ë¦„ ê¸°ë³¸ ì „ëµ:** MemberServiceImpl í´ë˜ìŠ¤ memberServiceImpl

**ë¹ˆ ì´ë¦„ ì§ì ‘ ì§€ì •:** ë§Œì•½ ìŠ¤í”„ë§ ë¹ˆì˜ ì´ë¦„ì„ ì§ì ‘ ì§€ì •í•˜ê³  ì‹¶ìœ¼ë©´
@Component("memberService2") ì´ëŸ°ì‹ìœ¼ë¡œ ì´ë¦„ì„ ë¶€ì—¬í•˜ë©´ ëœë‹¤.

**2. @Autowired ì˜ì¡´ê´€ê³„ ìë™ ì£¼ì…**

![ì œëª©](../ì´ë¯¸ì§€/05_ì»´í¬ë„ŒíŠ¸_ìŠ¤ìº”1.png)

ìƒì„±ìì— @Autowired ë¥¼ ì§€ì •í•˜ë©´, ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ìë™ìœ¼ë¡œ í•´ë‹¹ ìŠ¤í”„ë§ ë¹ˆì„ ì°¾ì•„ì„œ ì£¼ì…í•œë‹¤.

ì´ë•Œ ê¸°ë³¸ ì¡°íšŒ ì „ëµì€ íƒ€ì…ì´ ê°™ì€ ë¹ˆì„ ì°¾ì•„ì„œ ì£¼ì…í•œë‹¤.
getBean(MemberRepository.class) ì™€ ë™ì¼í•˜ë‹¤ê³  ì´í•´í•˜ë©´ ëœë‹¤.

## íƒìƒ‰ ìœ„ì¹˜ì™€ ê¸°ë³¸ ìŠ¤ìº” ëŒ€ìƒ

**íƒìƒ‰í•  íŒ¨í‚¤ì§€ì˜ ì‹œì‘ ìœ„ì¹˜ ì§€ì •**

ëª¨ë“  ìë°” í´ë˜ìŠ¤ë¥¼ ë‹¤ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”í•˜ë©´ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦°ë‹¤. ê·¸ë˜ì„œ ê¼­ í•„ìš”í•œ ìœ„ì¹˜ë¶€í„° íƒìƒ‰í•˜ë„ë¡ ì‹œì‘
ìœ„ì¹˜ë¥¼ ì§€ì •í•  ìˆ˜ ìˆë‹¤.

```java
@ComponentScan(
		 basePackages = "hello.core",
}
```

```
@ComponentScan(
 basePackageClasses = "AutoAppConfig.class",
}
```

 ìœ„ì™€ ê°™ì´Â `basePackages`ë¥¼ ì„ ì–¸í•˜ì—¬ íŠ¹ì • íŒ¨í‚¤ì§€ë¥¼ ë£¨íŠ¸ë¡œ ì§€ì •í•  ìˆ˜ ìˆë‹¤.

- `basePackages = {"hello.core", "hello.service"}`
- `bsePackageClasses` ì†ì„±ì€ ì§€ì •í•œ í´ë˜ìŠ¤ì˜ íŒ¨í‚¤ì§€ë¥¼ ìŠ¤ìº”ì˜ ì‹œì‘ ìœ„ì¹˜ë¡œ ì§€ì •í•œë‹¤.

ë¬¼ë¡ , í˜„ì¬ í´ë˜ìŠ¤ê°€ ì•„ë‹Œ ë‹¤ë¥¸ í´ë˜ìŠ¤ë¥¼ ì§€ì •í•´ì„œ ì‚¬ìš©í•´ë„ ë˜ë©°, ì§€ì •í•˜ì§€ ì•Šì•˜ë‹¤ë©´ `@ComponentScan`Â ì´ ë¶™ì€ ì„¤ì • ì •ë³´ í´ë˜ìŠ¤ì˜ íŒ¨í‚¤ì§€ê°€ ìŠ¤ìº”ì˜ ì‹œì‘ ìœ„ì¹˜ê°€ ëœë‹¤

**ê¶Œì¥í•˜ëŠ” ë°©ë²•**

ê°œì¸ì ìœ¼ë¡œ ì¦ê²¨ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì€ íŒ¨í‚¤ì§€ ìœ„ì¹˜ë¥¼ ì§€ì •í•˜ì§€ ì•Šê³ , ì„¤ì • ì •ë³´ í´ë˜ìŠ¤ì˜ ìœ„ì¹˜ë¥¼ í”„ë¡œì íŠ¸ ìµœìƒë‹¨ì— ë‘ëŠ” ê²ƒì´ë‹¤. ìµœê·¼ ìŠ¤í”„ë§ ë¶€íŠ¸ë„ ì´ ë°©ë²•ì„ ê¸°ë³¸ìœ¼ë¡œ ì œê³µí•œë‹¤.

> ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´ ìŠ¤í”„ë§ ë¶€íŠ¸ì˜ ëŒ€í‘œ ì‹œì‘ ì •ë³´ì¸ `@SpringBootApplication` ë¥¼ ì´ í”„ë¡œì íŠ¸ ì‹œì‘ ë£¨íŠ¸ ìœ„ì¹˜ì— ë‘ëŠ” ê²ƒì´ ê´€ë¡€ì´ë‹¤. (ê·¸ë¦¬ê³  ì´ ì„¤ì •ì•ˆì— ë°”ë¡œ `@ComponentScan` ì´ ë“¤ì–´ìˆë‹¤!)
>

### ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ê¸°ë³¸ ëŒ€ìƒ

- **@Component :**Â ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì—ì„œ ì‚¬ìš©
- **@Controlller :**Â ìŠ¤í”„ë§ MVC ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì‚¬ìš©
- **@Service :**Â ìŠ¤í”„ë§ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ì„œ ì‚¬ìš©
- **@Repository :**Â ìŠ¤í”„ë§ ë°ì´í„° ì ‘ê·¼ ê³„ì¸µì—ì„œ ì‚¬ìš©
- **@Configuration :**Â ìŠ¤í”„ë§ ì„¤ì • ì •ë³´ì—ì„œ ì‚¬ìš©

```
@Component
public @interface Controller {
}
@Component
public @interface Service {
}
@Component
public @interface Configuration {
}
```

ì–´ë…¸í…Œì´ì…˜ì„ ëœ¯ì–´ë³´ë©´ @Component ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì—¬ìˆìŒ

ì°¸ê³  -  ì–´ë…¸í…Œì´ì…˜ì—ëŠ” ìƒì†ê´€ê³„ë¼ëŠ” ê²ƒì´ ì—†ë‹¤.

ê·¸ë˜ì„œ ì´ë ‡ê²Œ ì–´ë…¸í…Œì´ì…˜ì´ íŠ¹ì • ì–´ë…¸í…Œì´ì…˜ì„ ë“¤ê³  ìˆëŠ” ê²ƒì„ ì¸ì‹í•  ìˆ˜ ìˆëŠ” ê²ƒì€

ìë°” ì–¸ì–´ê°€ ì§€ì›í•˜ëŠ” ê¸°ëŠ¥ì€ ì•„ë‹ˆê³ , ìŠ¤í”„ë§ì´ ì§€ì›í•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤.

ì •í™•íˆëŠ” ìŠ¤í”„ë§ì—ì„œ ì œê³µí•˜ëŠ” `ì–´ë…¸í…Œì´ì…˜ í”„ë¡œì„¸ì„œ/ì–´ë…¸í…Œì´ì…˜ í”„ë¡œì„¸ì‹±` ì„ ì´ìš©í•œ ë°©ë²•

ìŠ¤í”„ë§ì˜ ë¶€ê°€ê¸°ëŠ¥

- **@Controller :**Â ìŠ¤í”„ë§ MVC ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ì¸ì‹
- **@Repository :**Â ìŠ¤í”„ë§ ë°ì´í„° ì ‘ê·¼ ê³„ì¸µìœ¼ë¡œ ì¸ì‹í•˜ê³ , ë°ì´í„° ê³„ì¸µì˜ ì˜ˆì™¸ë¥¼ ìŠ¤í”„ë§ ì˜ˆì™¸ë¡œ ë³€í™˜í•´ì¤€ë‹¤.
- **@Configuration :**Â ì•ì„œ ë³´ì•˜ë“¯ì´ ìŠ¤í”„ë§ ì„¤ì • ì •ë³´ë¡œ ì¸ì‹í•˜ê³ ,ìŠ¤í”„ë§ ë¹ˆì´ ì‹±ê¸€í†¤ì„ ìœ ì§€í•˜ë„ë¡ ì¶”ê°€ ì²˜ë¦¬ë¥¼ í•œë‹¤.
- **@Service :**Â ì‚¬ì‹¤Â `@Service`Â ëŠ” íŠ¹ë³„í•œ ì²˜ë¦¬ë¥¼ í•˜ì§€ ì•ŠëŠ”ë‹¤.ëŒ€ì‹  ê°œë°œìë“¤ì´ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì—¬ê¸°ì— ìˆê² êµ¬ë‚˜ ë¼ê³  ë¹„ì¦ˆë‹ˆìŠ¤ ê³„ì¸µì„ ì¸ì‹í•˜ëŠ”ë° ë„ì›€ì´ ëœë‹¤.

### í•„í„°

`@ComponentScan`ì˜ ì†ì„±ì¤‘ì— íŠ¹ì • ë¹ˆì„ ë“±ë¡í•˜ê±°ë‚˜ ë“±ë¡í•˜ì§€ ì•Šë„ë¡ í•˜ëŠ” ê¸°ëŠ¥ì´ ìˆë‹¤.

- **includeFilters :**Â ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ëŒ€ìƒì„ ì¶”ê°€ë¡œ ì§€ì •í•œë‹¤.
- **excludeFilters :**Â ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì—ì„œ ì œì™¸í•  ëŒ€ìƒì„ ì§€ì •í•œë‹¤

ì´ ë¶€ë¶„ì— ëŒ€í•´ì„œ ìš°ì„ , ì½”ë“œë¡œ ë™ì‘ì„ ì´í•´í•˜ê³  ì •ë¦¬í•´ë³´ì

**src.test.hello.core.scan.filter.MyIncludeComponent.interface**

```
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Component
public @interface MyIncludeComponent {

}
```

```
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Component
public @interface MyExcludeComponent {

}
```

```
@MyIncludeComponent
public class BeanB {
}
```

```
public class ComponentFilterAppConfigTest {

    @Test
    void filterScan() {
        ApplicationContext ac = new AnnotationConfigApplicationContext(ComponentFilterAppConfig.class);
        BeanA beanA = ac.getBean("beanA", BeanA.class);
        assertThat(beanA).isNotNull();

        assertThatThrownBy(()-> ac.getBean("beanB", BeanB.class))
                .isInstanceOf(NoSuchBeanDefinitionException.class);
    }

    @ComponentScan(
            includeFilters = @Filter(type = FilterType.ANNOTATION, classes = MyIncludeComponent.class),
            excludeFilters = @Filter(type = FilterType.ANNOTATION, classes = MyExcludeComponent.class)
    )
    @Configuration
    static class ComponentFilterAppConfig {

    }
}
```

ì½”ë“œì—ì„œ ì•Œ ìˆ˜ ìˆë“¯ì´, íŠ¹ì • ì–´ë…¸í…Œì´ì…˜ì— ë”°ë¼ íŠ¹ì • ë¹ˆì„ ë“±ë¡í•˜ê±°ë‚˜ ì˜ˆì™¸ì‹œí‚¤ê³  ìˆë‹¤.

ì´ ê³¼ì •ì—ì„œ í•œ ê°€ì§€ ëˆˆì—¬ê²¨ ë³¼ ì ì´ ìˆëŠ”ë°, ë°”ë¡œ `@ComponentScan.FilterType`ì´ë‹¤.

**FilterType ì˜µì…˜**FilterTypeì€ 5ê°€ì§€ ì˜µì…˜ì´ ìˆë‹¤.

- **ANNOTATION:**Â ê¸°ë³¸ê°’, ì• ë…¸í…Œì´ì…˜ì„ ì¸ì‹í•´ì„œ ë™ì‘í•œë‹¤.
    - ex) org.example.SomeAnnotation
- **ASSIGNABLE_TYPE:**Â ì§€ì •í•œ íƒ€ì…ê³¼ ìì‹ íƒ€ì…ì„ ì¸ì‹í•´ì„œ ë™ì‘í•œë‹¤.
    - ex) org.example.SomeClass
- **ASPECTJ:**Â AspectJ íŒ¨í„´ ì‚¬ìš©
    - ex) org.example..*Service+
- **REGEX:**Â ì •ê·œ í‘œí˜„ì‹
    - ex) org.example.Default.*
- **CUSTOM:**Â TypeFilter ì´ë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì„œ ì²˜ë¦¬
    - ex) org.example.MyTypeFilter


â†’ ìµœê·¼ ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì„ ê¸°ë³¸ìœ¼ë¡œ ì œê³µí•˜ëŠ”ë°, ì˜µì…˜ì„ ë³€ê²½í•˜ë©´ì„œ ì‚¬ìš©í•˜ê¸°ë³´ë‹¤ëŠ” ìŠ¤í”„ë§ì˜ ê¸°ë³¸ ì„¤ì •ì— ìµœëŒ€í•œ ë§ì¶”ì–´ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.

## ì¤‘ë³µ ë“±ë¡ê³¼ ì¶©ëŒ

ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì„ ì‚¬ìš©í•˜ë©´ì„œë„ ë“±ë¡ëœ ë¹ˆë“¤ë¼ë¦¬ì˜ ì¶©ëŒì€ ì–¸ì œë‚˜ ì¼ì–´ë‚  ìˆ˜ ìˆë‹¤.

ë¹ˆì´ ì¶©ëŒë‚˜ëŠ” ê²½ìš°ë¡œ í¬ê²Œ ë‘ê°€ì§€ ìƒí™©ì´ ìˆë‹¤.

1. ìë™ ë¹ˆ ë“±ë¡ vs ìë™ ë¹ˆ ë“±ë¡

`ConflictingBeanDefinitionException`Â ì˜ˆì™¸ ë°œìƒ

1. ìˆ˜ë™ ë¹ˆ ë“±ë¡ vs ìë™ ë¹ˆ ë“±ë¡

**ìµœê·¼ ìŠ¤í”„ë§ ë¶€íŠ¸ì—ì„œëŠ” ìˆ˜ë™ ë¹ˆ ë“±ë¡ê³¼ ìë™ ë¹ˆ ë“±ë¡ì´ ì¶©ëŒë‚˜ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë„ë¡ ê¸°ë³¸ ê°’ì„ ë°”ê¾¸ì—ˆë‹¤.**

```
Consider renaming one of the beans or enabling overriding by setting
spring.main.allow-bean-definition-overriding=true
```

ì˜¤ë²„ë¼ì´ë”© í•˜ê¸¸ ì›í•œë‹¤ë©´ ìœ„ setting ê°’ì„ ì¶”ê°€í•´ì£¼ë©´ ëœë‹¤. â†’ ì˜¤ë²„ë¼ì´ë”© ë¡œê·¸

```
Overriding bean definition for bean 'memoryMemberRepository' with a different
definition: replacing
```